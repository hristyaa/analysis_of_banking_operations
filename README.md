# Приложение для анализа транзакций, которые находятся в Excel-файле.

## Описание:

Приложение для анализа транзакций, которые находятся в Excel-файле - это проект на Python.
Приложение генерирует JSON-данные для веб-страницы, формирует Excel-отчет, а также предоставляет другие сервисы.

## Возможности:

Приложение считываниет данные с транзакциями из Excel-файла и предлагает следующие возможности: 
1. Веб-страница 'Главная', которая выдает JSON-ответ со следующими данными:
- Приветствие в зависимости от текущего времени.
- По каждой карте:последние 4 цифры карты;общая сумма расходов;кешбэк (1 рубль на каждые 100 рублей).
- Топ-5 транзакций по сумме платежа.
- Курс валют.
- Стоимость акций из S&P500.
2. Сервисы:
- Выгодные категории повышенного кешбэка.
- Инвесткопилка.
3. Отчет 'Траты по категории'.

ВНИМАНИЕ! Для корректной работы Excel-файл с транзакциями должны быть расположены в папке data/.

## Установка:

Клонируйте репозиторий:
```
git clone https://github.com/hristyaa/analysis_of_banking_operations.git
```
Скопируйте файл .env,example, переименуйте его в .env и замените значения переменных реальными.
Валюты и акции для отображения на веб-страницах задаются в отдельном файле пользовательских настроек 
user_settings.json.

## Запуск:

```
python main.py
```

## Функциональные возможности:

1. **Веб-страница 'Главная'**.
Основные функции для генерации JSON-ответов реализуются в отдельном модуле views.py.
- Функция get_data_of_cards принимает список словарей с банковскими операциями
и диапазон дат для анализа (start_date, end_date), возвращает список словарей с данными 
по каждой карте в заданном периоде.
- Функция get_top_list_transction принимает список словарей с банковскими операциями
и диапазон дат для анализа (start_date, end_date) и формирует лист словарей "Топ-5 транзакций по сумме платежа".
- Функция get_currency_rates возвращает курс валют.
- Функция get_stock_prices возвращает стоимость акций из S&P500.
- Главная функция home_page принимает список словарей с банковскими операциями из Excel-файла и дату, 
введенную пользователем, возвращает требуемый json-ответ в формате:
```
{
  "greeting": "Добрый день",
  "cards": [
    {
      "last_digits": "5814",
      "total_spent": 1262.00,
      "cashback": 12.62
    },
    {
      "last_digits": "7512",
      "total_spent": 7.94,
      "cashback": 0.08
    }
  ],
  "top_transactions": [
    {
      "date": "21.12.2021",
      "amount": 1198.23,
      "category": "Переводы",
      "description": "Перевод Кредитная карта. ТП 10.2 RUR"
    },
    {
      "date": "20.12.2021",
      "amount": 829.00,
      "category": "Супермаркеты",
      "description": "Лента"
    },
    {
      "date": "20.12.2021",
      "amount": 421.00,
      "category": "Различные товары",
      "description": "Ozon.ru"
    },
    {
      "date": "16.12.2021",
      "amount": -14216.42,
      "category": "ЖКХ",
      "description": "ЖКУ Квартира"
    },
    {
      "date": "16.12.2021",
      "amount": 453.00,
      "category": "Бонусы",
      "description": "Кешбэк за обычные покупки"
    }
  ],
  "currency_rates": [
    {
      "currency": "USD",
      "rate": 73.21
    },
    {
      "currency": "EUR",
      "rate": 87.08
    }
  ],
  "stock_prices": [
    {
      "stock": "AAPL",
      "price": 150.12
    },
    {
      "stock": "AMZN",
      "price": 3173.18
    },
    {
      "stock": "GOOGL",
      "price": 2742.39
    },
    {
      "stock": "MSFT",
      "price": 296.71
    },
    {
      "stock": "TSLA",
      "price": 1007.08
    }
  ]
}.
```
Вспомогательные функции, необходимые для работы функции страницы «Главная», расположены в модуле utils.py.
- Функция reader_excel_file считывает данные из Excel и выдает список словарей с банковскими операциями.
- Функция greeting приветствует в зависимости от текущего времени.
- Функция get_start_and_end_date определяет диапазон дат для анализа по заданной дате в формате YYYY-MM-DD HH:MM:SS.
Если дата — 20.05.2020, то данные для анализа будут в диапазоне 01.05.2020-20.05.2020.

2. **Сервисы.**
Функции для реализации сервисов находятся в отдельном модуле services.py.
- ****_Выгодные категории повышенного кешбэка._****
Сервис позволяет проанализировать, какие категории были наиболее выгодными 
для выбора в качестве категорий повышенного кешбэка.
Функция get_analysis_categories_of_increased_cashback принимает список словарей 
с банковскими операциями, год, месяц, и анализирует выгодность категории повышенного кешбэка.

Формат выходных данных:

```
{
    "Категория 1": 1000,
    "Категория 2": 2000,
    "Категория 3": 500
}
```

- ****_Инвесткопилка._****
Позволяет копить через округление ваших трат.
Можно задать комфортный порог округления: 10, 50 или 100 ₽. Траты будут округляться, 
и разница между фактической суммой трат по карте и суммой округления будет попадать 
на счет «Инвесткопилки».


```
Пример:
Вы настроили шаг округления 50 ₽. Покупка на 1712 ₽ автоматически округлится до 1750 ₽, и 38 ₽ попадут в «Инвесткопилку». 
Чем активнее расплачиваетесь картой, тем быстрее копятся деньги в копилке.
```
Функция investment_bank принимает список словарей с банковскими операциями, месяц, 
для которого рассчитывается отложенная сумма (строка в формате 'YYYY-MM'), предел, 
до которого нужно округлять суммы операций (целое число) и возвращает сумму, 
которую удалось бы отложить в «Инвесткопилку»

3. **Отчет 'Траты по категории'**
Функция для реализации отчета находится в отдельном модуле reports.py.
Функция spending_by_category принимает на вход:
датафрейм с транзакциями,
название категории,
опциональную дату.
Если дата не передана, то берется текущая дата.
Функция spending_by_category возвращает траты по заданной категории за последние три месяца (от переданной даты).
В данном модуле реализован декоратор spending_by_category, который 
по запросу пользователя записывает данные отчета в файл с названием 
по умолчанию 'report.json' или в заданный файл в директорию reports


## Тестирование
 
Тестирование выполняется с помощью фреймоворка pytest. Для запуска выполните команду:
```
pytest 
```
